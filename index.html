<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Widget Dropdown Dinâmico</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 1rem; }
  </style>
</head>
<body>

  <label for="dropdown">Selecione uma categoria:</label>
  <select id="dropdown">
    <option disabled selected>A carregar opções...</option>
  </select>

  <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
  <script>
    async function carregarOpcoes() {
      const apiKey = "9be9a89e6af80cf2e4a4891b2170dd0b";
      const formID = "251124801004338";
      const campoID = "3"; // Altera aqui conforme o ID do campo correto

      try {
        const response = await fetch(`https://eu-api.jotform.com/form/${formID}/submissions?apiKey=${apiKey}`);
        const data = await response.json();

        const dropdown = document.getElementById("dropdown");
        dropdown.innerHTML = "<option disabled selected>Escolha uma opção...</option>";

        const opcoesUnicas = new Set();

        data.content.forEach(submissao => {
          const resposta = submissao.answers[campoID]?.answer;

          if (resposta && !opcoesUnicas.has(resposta)) {
            opcoesUnicas.add(resposta);
            const opt = document.createElement("option");
            opt.value = resposta;
            opt.textContent = resposta;
            dropdown.appendChild(opt);
          }
        });
      } catch (erro) {
        alert("Erro ao carregar opções do dropdown.");
        console.error(erro);
      }
    }

    document.getElementById("dropdown").addEventListener("change", function () {
      const valor = this.value;
      JFCustomWidget.sendData({
        value: valor
      });
    });

    carregarOpcoes();
  </script>
</body>
</html>
