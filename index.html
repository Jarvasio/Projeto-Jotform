<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Widget Dropdown Dinâmico</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 1rem; }
  </style>
</head>
<body>

  <label for="dropdown">Selecione uma categoria:</label>
  <select id="dropdown">
    <option disabled selected>A carregar opções...</option>
  </select>

  <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
 <script>
  async function carregarOpcoes() {
    const apiKey = "9be9a89e6af80cf2e4a4891b2170dd0b";
    const formID = "251124801004338";

    try {
      const response = await fetch(`https://eu-api.jotform.com/form/${formID}/submissions?apiKey=${apiKey}&limit=1000`);
      const data = await response.json();

      const dropdown = document.getElementById("dropdown");
      dropdown.innerHTML = "<option disabled selected>Escolha uma opção...</option>";

      const opcoesUnicas = new Set();

      data.content.forEach(submissao => {
        let resposta = submissao.answers["1"]?.answer;

        // Se for array (ex: múltiplas escolhas), tratar cada item
        if (Array.isArray(resposta)) {
          resposta.forEach(item => {
            const limpo = item.trim();
            if (limpo && !opcoesUnicas.has(limpo)) {
              opcoesUnicas.add(limpo);
              dropdown.appendChild(new Option(limpo, limpo));
            }
          });
        } else if (typeof resposta === "string") {
          const limpo = resposta.trim();
          if (limpo && !opcoesUnicas.has(limpo)) {
            opcoesUnicas.add(limpo);
            dropdown.appendChild(new Option(limpo, limpo));
          }
        }

        // DEBUG opcional
        // console.log("Valor recebido:", resposta);
      });
    } catch (erro) {
      alert("Erro ao carregar opções do dropdown.");
      console.error(erro);
    }
  }

  document.getElementById("dropdown").addEventListener("change", function () {
    const valor = this.value;
    JFCustomWidget.sendData({
      value: valor
    });
  });

  carregarOpcoes();

   const todasAsRespostas = [];

data.content.forEach((submissao) => {
  let resposta = submissao.answers["1"]?.answer;

  if (Array.isArray(resposta)) {
    resposta.forEach(item => todasAsRespostas.push(item.trim()));
  } else if (typeof resposta === "string") {
    todasAsRespostas.push(resposta.trim());
  }
});

console.log("Total de valores únicos:", new Set(todasAsRespostas).size);
console.log("Todos os valores:", todasAsRespostas);
</script>
</body>
</html>
