<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Formulário com Dropdown Dinâmico</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    iframe { width: 100%; height: 700px; border: 2px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>

  <h2>Escolher uma opção</h2>
  <label for="dropdown">Selecione uma categoria:</label>
  <select id="dropdown">
    <option disabled selected>A carregar opções...</option>
  </select>


  <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>

  <script>
    async function carregarOpcoes() {
      const apiKey = "9be9a89e6af80cf2e4a4891b2170dd0b";
      const formID = "250995384164063";

      try {
        const response = await fetch(`https://eu-api.jotform.com/form/${formID}/submissions?apiKey=${apiKey}`);
        const data = await response.json();

        const dropdown = document.getElementById("dropdown");
        dropdown.innerHTML = "<option disabled selected>Escolha uma opção...</option>";

        const opcoesUnicas = new Set();

        data.content.forEach(submissao => {
          const resposta = submissao.answers["3"]?.answer;
          if (resposta && !opcoesUnicas.has(resposta)) {
            opcoesUnicas.add(resposta);
            const opt = document.createElement("option");
            opt.value = resposta;
            opt.textContent = resposta;
            dropdown.appendChild(opt);
          }
        });
      } catch (erro) {
        alert("Erro ao carregar opções do dropdown.");
        console.error(erro);
      }
    }

    document.getElementById("dropdown").addEventListener("change", function () {
      const valor = encodeURIComponent(this.value);
      //const iframe = document.getElementById("JotFormIFrame-250854445418057");

      // ⚠️ Campo correto: q4_testeDe
      //onst novoSRC = `https://form.jotform.com/250854445418057?q4_testeDe=${valor}`;
      iframe.src = novoSRC;
    });
    
    JJFCustomWidget.sendData({
        value: this.value
      });

    carregarOpcoes();

  </script>
</body>
</html>
